[
  {
    "cmd": [
      "python",
      "-u",
      "\nimport os.path\nif os.path.exists(os.path.join('/home/goma/goma','gomacc')):\n  exit(0)\nexit(1)\n"
    ],
    "name": "check gomacc file",
    "~followup_annotations": [
      "@@@STEP_LOG_LINE@python.inline@@@@",
      "@@@STEP_LOG_LINE@python.inline@import os.path@@@",
      "@@@STEP_LOG_LINE@python.inline@if os.path.exists(os.path.join('/home/goma/goma','gomacc')):@@@",
      "@@@STEP_LOG_LINE@python.inline@  exit(0)@@@",
      "@@@STEP_LOG_LINE@python.inline@exit(1)@@@",
      "@@@STEP_LOG_END@python.inline@@@"
    ]
  },
  {
    "cmd": [
      "gn",
      "gen",
      "out/Release",
      "--args=use_goma=true goma_dir=/home/goma/goma"
    ],
    "name": "gn"
  },
  {
    "cmd": [
      "python",
      "-u",
      "RECIPE_PACKAGE_REPO[build]/scripts/tools/runit.py",
      "--show-path",
      "--with-third-party-lib",
      "--",
      "python",
      "RECIPE_MODULE[build::goma]/resources/utils.py",
      "jobs",
      "--file-path",
      "/path/to/tmp/"
    ],
    "name": "calculate the number of recommended jobs"
  },
  {
    "cmd": [],
    "name": "preprocess_for_goma"
  },
  {
    "cmd": [
      "python",
      "-u",
      "RECIPE_MODULE[recipe_engine::file]/resources/fileutil.py",
      "--json-output",
      "/path/to/tmp/json",
      "ensure-directory",
      "--mode",
      "0777",
      "[CACHE]/goma/test_builder"
    ],
    "infra_step": true,
    "name": "preprocess_for_goma.goma cache directory",
    "~followup_annotations": [
      "@@@STEP_NEST_LEVEL@1@@@"
    ]
  },
  {
    "cmd": [
      "python",
      "-u",
      "/home/goma/goma/goma_ctl.py",
      "restart"
    ],
    "env": {
      "GOMACTL_CRASH_REPORT_ID_FILE": "build_data_dir/crash_report_id_file",
      "GOMA_CACHE_DIR": "[CACHE]/goma/test_builder",
      "GOMA_DUMP_COUNTERZ_FILE": "[TMP_BASE]/goma_counterz",
      "GOMA_DUMP_STATS_FILE": "build_data_dir/goma_stats_proto",
      "GOMA_ENABLE_COUNTERZ": "true",
      "GOMA_HERMETIC": "error"
    },
    "infra_step": true,
    "name": "preprocess_for_goma.start_goma",
    "~followup_annotations": [
      "@@@STEP_NEST_LEVEL@1@@@"
    ]
  },
  {
    "cmd": [
      "ninja",
      "-C",
      "out/Release",
      "-j",
      "50"
    ],
    "name": "ninja"
  },
  {
    "cmd": [],
    "name": "postprocess_for_goma"
  },
  {
    "cmd": [
      "python",
      "-u",
      "/home/goma/goma/goma_ctl.py",
      "jsonstatus",
      "[TMP_BASE]/goma_jsonstatus.json"
    ],
    "env": {
      "GOMACTL_CRASH_REPORT_ID_FILE": "build_data_dir/crash_report_id_file",
      "GOMA_CACHE_DIR": "[CACHE]/goma/test_builder",
      "GOMA_DUMP_COUNTERZ_FILE": "[TMP_BASE]/goma_counterz",
      "GOMA_DUMP_STATS_FILE": "build_data_dir/goma_stats_proto",
      "GOMA_ENABLE_COUNTERZ": "true",
      "GOMA_HERMETIC": "error"
    },
    "name": "postprocess_for_goma.goma_jsonstatus",
    "~followup_annotations": [
      "@@@STEP_NEST_LEVEL@1@@@",
      "@@@STEP_LOG_LINE@json.output@{@@@",
      "@@@STEP_LOG_LINE@json.output@  \"notice\": [@@@",
      "@@@STEP_LOG_LINE@json.output@    {@@@",
      "@@@STEP_LOG_LINE@json.output@      \"infra_status\": {@@@",
      "@@@STEP_LOG_LINE@json.output@        \"num_user_error\": 0, @@@",
      "@@@STEP_LOG_LINE@json.output@        \"ping_status_code\": 200@@@",
      "@@@STEP_LOG_LINE@json.output@      }@@@",
      "@@@STEP_LOG_LINE@json.output@    }@@@",
      "@@@STEP_LOG_LINE@json.output@  ]@@@",
      "@@@STEP_LOG_LINE@json.output@}@@@",
      "@@@STEP_LOG_END@json.output@@@"
    ]
  },
  {
    "cmd": [
      "python",
      "-u",
      "/home/goma/goma/goma_ctl.py",
      "stat"
    ],
    "env": {
      "GOMACTL_CRASH_REPORT_ID_FILE": "build_data_dir/crash_report_id_file",
      "GOMA_CACHE_DIR": "[CACHE]/goma/test_builder",
      "GOMA_DUMP_COUNTERZ_FILE": "[TMP_BASE]/goma_counterz",
      "GOMA_DUMP_STATS_FILE": "build_data_dir/goma_stats_proto",
      "GOMA_ENABLE_COUNTERZ": "true",
      "GOMA_HERMETIC": "error"
    },
    "name": "postprocess_for_goma.goma_stat",
    "~followup_annotations": [
      "@@@STEP_NEST_LEVEL@1@@@"
    ]
  },
  {
    "cmd": [
      "python",
      "-u",
      "/home/goma/goma/goma_ctl.py",
      "stop"
    ],
    "env": {
      "GOMACTL_CRASH_REPORT_ID_FILE": "build_data_dir/crash_report_id_file",
      "GOMA_CACHE_DIR": "[CACHE]/goma/test_builder",
      "GOMA_DUMP_COUNTERZ_FILE": "[TMP_BASE]/goma_counterz",
      "GOMA_DUMP_STATS_FILE": "build_data_dir/goma_stats_proto",
      "GOMA_ENABLE_COUNTERZ": "true",
      "GOMA_HERMETIC": "error"
    },
    "name": "postprocess_for_goma.stop_goma",
    "~followup_annotations": [
      "@@@STEP_NEST_LEVEL@1@@@"
    ]
  },
  {
    "cmd": [
      "vpython",
      "-u",
      "RECIPE_PACKAGE_REPO[build]/scripts/tools/runit.py",
      "--show-path",
      "--",
      "python",
      "RECIPE_PACKAGE_REPO[build]/scripts/slave/upload_goma_logs.py",
      "--upload-compiler-proxy-info",
      "--log-url-json-file",
      "/path/to/tmp/json",
      "--gsutil-py-path",
      "RECIPE_PACKAGE_REPO[depot_tools]/gsutil.py",
      "--bigquery-service-account-json",
      "/creds/service_accounts/service-account-goma-bigquery.json",
      "--json-status",
      "[TMP_BASE]/goma_jsonstatus.json",
      "--ninja-log-outdir",
      "out/Release",
      "--ninja-log-command-file",
      "[\"ninja\", \"-C\", \"out/Release\", \"-j\", \"50\"]",
      "--build-exit-status",
      "0",
      "--build-step-name",
      "ninja",
      "--ninja-log-compiler",
      "goma",
      "--build-data-dir",
      "build_data_dir",
      "--goma-stats-file",
      "build_data_dir/goma_stats_proto",
      "--goma-counterz-file",
      "[TMP_BASE]/goma_counterz",
      "--goma-crash-report-id-file",
      "build_data_dir/crash_report_id_file",
      "--build-id",
      "1",
      "--buildbot-buildername",
      "test_builder",
      "--buildbot-mastername",
      "test_master",
      "--buildbot-slavename",
      "test_slave",
      "--buildbot-clobber",
      "1"
    ],
    "name": "postprocess_for_goma.upload_log",
    "~followup_annotations": [
      "@@@STEP_NEST_LEVEL@1@@@",
      "@@@STEP_LOG_LINE@json.output@{@@@",
      "@@@STEP_LOG_LINE@json.output@  \"compiler_proxy_log\": \"https://chromium-build-stats.appspot.com/compiler_proxy_log/2017/03/30/build11-m1/compiler_proxy.exe.BUILD11-M1.chrome-bot.log.INFO.20170329-222936.4420.gz\", @@@",
      "@@@STEP_LOG_LINE@json.output@  \"ninja_log\": \"https://chromium-build-stats.appspot.com/ninja_log/2017/03/30/build11-m1/ninja_log.build11-m1.chrome-bot.20170329-224321.9976.gz\"@@@",
      "@@@STEP_LOG_LINE@json.output@}@@@",
      "@@@STEP_LOG_END@json.output@@@",
      "@@@STEP_LINK@compiler_proxy_log@https://chromium-build-stats.appspot.com/compiler_proxy_log/2017/03/30/build11-m1/compiler_proxy.exe.BUILD11-M1.chrome-bot.log.INFO.20170329-222936.4420.gz@@@",
      "@@@STEP_LINK@ninja_log@https://chromium-build-stats.appspot.com/ninja_log/2017/03/30/build11-m1/ninja_log.build11-m1.chrome-bot.20170329-224321.9976.gz@@@"
    ]
  },
  {
    "name": "$result",
    "recipe_result": null,
    "status_code": 0
  }
]