[
  {
    "cmd": [
      "python",
      "-u",
      "RECIPE_MODULE[depot_tools::gitiles]/resources/gerrit_client.py",
      "--json-file",
      "/path/to/tmp/json",
      "--url",
      "https://dart.googlesource.com/repo/+/deadbeef",
      "--format",
      "json"
    ],
    "name": "commit log: deadbeef",
    "~followup_annotations": [
      "@@@STEP_LOG_LINE@json.output@{@@@",
      "@@@STEP_LOG_LINE@json.output@  \"author\": {@@@",
      "@@@STEP_LOG_LINE@json.output@    \"email\": \"testauthor@fake.chromium.org\", @@@",
      "@@@STEP_LOG_LINE@json.output@    \"name\": \"Test Author\", @@@",
      "@@@STEP_LOG_LINE@json.output@    \"time\": \"Mon Jan 01 00:00:00 2015\"@@@",
      "@@@STEP_LOG_LINE@json.output@  }, @@@",
      "@@@STEP_LOG_LINE@json.output@  \"commit\": \"f49cf6381e322b147053b74e4500af8533ac1e4c\", @@@",
      "@@@STEP_LOG_LINE@json.output@  \"committer\": {@@@",
      "@@@STEP_LOG_LINE@json.output@    \"email\": \"testauthor@fake.chromium.org\", @@@",
      "@@@STEP_LOG_LINE@json.output@    \"name\": \"Test Author\", @@@",
      "@@@STEP_LOG_LINE@json.output@    \"time\": \"Mon Jan 01 00:00:00 2015\"@@@",
      "@@@STEP_LOG_LINE@json.output@  }, @@@",
      "@@@STEP_LOG_LINE@json.output@  \"message\": \"Subject\\n\\nMessage\\n\", @@@",
      "@@@STEP_LOG_LINE@json.output@  \"parents\": [@@@",
      "@@@STEP_LOG_LINE@json.output@    \"04165e9e425e4b5c7a0b18e284fc410463b04d79\"@@@",
      "@@@STEP_LOG_LINE@json.output@  ], @@@",
      "@@@STEP_LOG_LINE@json.output@  \"tree\": \"15d8d3a3b3cccf02dd6a5de70673225ae52c500f\", @@@",
      "@@@STEP_LOG_LINE@json.output@  \"tree_diff\": [@@@",
      "@@@STEP_LOG_LINE@json.output@    {@@@",
      "@@@STEP_LOG_LINE@json.output@      \"new_id\": \"8a2c4298c6158bd5567574b74da3b8c08c615ae3\", @@@",
      "@@@STEP_LOG_LINE@json.output@      \"new_mode\": 33188, @@@",
      "@@@STEP_LOG_LINE@json.output@      \"new_path\": \"foo/bar\", @@@",
      "@@@STEP_LOG_LINE@json.output@      \"old_id\": \"0000000000000000000000000000000000000000\", @@@",
      "@@@STEP_LOG_LINE@json.output@      \"old_mode\": 0, @@@",
      "@@@STEP_LOG_LINE@json.output@      \"type\": \"add\"@@@",
      "@@@STEP_LOG_LINE@json.output@    }, @@@",
      "@@@STEP_LOG_LINE@json.output@    {@@@",
      "@@@STEP_LOG_LINE@json.output@      \"new_id\": \"6f0a466ac0818c64b2d8ee52fd1bd2f97f03a709\", @@@",
      "@@@STEP_LOG_LINE@json.output@      \"new_mode\": 33188, @@@",
      "@@@STEP_LOG_LINE@json.output@      \"new_path\": \"baz/qux\", @@@",
      "@@@STEP_LOG_LINE@json.output@      \"old_id\": \"0000000000000000000000000000000000000000\", @@@",
      "@@@STEP_LOG_LINE@json.output@      \"old_mode\": 0, @@@",
      "@@@STEP_LOG_LINE@json.output@      \"type\": \"add\"@@@",
      "@@@STEP_LOG_LINE@json.output@    }@@@",
      "@@@STEP_LOG_LINE@json.output@  ]@@@",
      "@@@STEP_LOG_LINE@json.output@}@@@",
      "@@@STEP_LOG_END@json.output@@@"
    ]
  },
  {
    "cmd": [
      "python",
      "-u",
      "RECIPE_MODULE[depot_tools::git]/resources/git_setup.py",
      "--path",
      "[CLEANUP]",
      "--url",
      "https://dart.googlesource.com/a/linearized_history.git"
    ],
    "name": "git setup"
  },
  {
    "cmd": [
      "git",
      "cache",
      "populate",
      "-c",
      "[CACHE]/git",
      "https://dart.googlesource.com/a/linearized_history.git"
    ],
    "cwd": "[CLEANUP]",
    "env": {
      "PATH": "RECIPE_REPO[depot_tools]:<PATH>"
    },
    "infra_step": true,
    "name": "populate cache"
  },
  {
    "cmd": [
      "git",
      "cache",
      "exists",
      "--quiet",
      "--cache-dir",
      "[CACHE]/git",
      "https://dart.googlesource.com/a/linearized_history.git"
    ],
    "cwd": "[CLEANUP]",
    "env": {
      "PATH": "RECIPE_REPO[depot_tools]:<PATH>"
    },
    "infra_step": true,
    "name": "git cache"
  },
  {
    "cmd": [
      "git",
      "remote",
      "set-url",
      "origin",
      "mirror_dir"
    ],
    "cwd": "[CLEANUP]",
    "env": {
      "PATH": "RECIPE_REPO[depot_tools]:<PATH>"
    },
    "infra_step": true,
    "name": "git remote"
  },
  {
    "cmd": [
      "git",
      "fetch",
      "origin",
      "master",
      "--progress"
    ],
    "cwd": "[CLEANUP]",
    "env": {
      "PATH": "RECIPE_REPO[depot_tools]:<PATH>"
    },
    "infra_step": true,
    "name": "git fetch"
  },
  {
    "cmd": [
      "git",
      "checkout",
      "-f",
      "FETCH_HEAD"
    ],
    "cwd": "[CLEANUP]",
    "infra_step": true,
    "name": "git checkout"
  },
  {
    "cmd": [
      "git",
      "rev-parse",
      "HEAD"
    ],
    "cwd": "[CLEANUP]",
    "infra_step": true,
    "name": "read revision",
    "~followup_annotations": [
      "@@@STEP_TEXT@<br/>checked out 'deadbeef'<br/>@@@"
    ]
  },
  {
    "cmd": [
      "git",
      "clean",
      "-f",
      "-d",
      "-x"
    ],
    "cwd": "[CLEANUP]",
    "infra_step": true,
    "name": "git clean"
  },
  {
    "cmd": [
      "git",
      "submodule",
      "sync"
    ],
    "cwd": "[CLEANUP]",
    "infra_step": true,
    "name": "submodule sync"
  },
  {
    "cmd": [
      "git",
      "submodule",
      "update",
      "--init",
      "--recursive"
    ],
    "cwd": "[CLEANUP]",
    "infra_step": true,
    "name": "submodule update"
  },
  {
    "cmd": [
      "python",
      "-u",
      "\nimport shutil\nimport sys\nshutil.copy(sys.argv[1], sys.argv[2])\n",
      "[CLEANUP]/commits.json",
      "/path/to/tmp/json"
    ],
    "cwd": "[CLEANUP]",
    "name": "read old commits",
    "~followup_annotations": [
      "@@@STEP_LOG_LINE@json.output@{@@@",
      "@@@STEP_LOG_LINE@json.output@  \"another_repo\": \"deadbeef\"@@@",
      "@@@STEP_LOG_LINE@json.output@}@@@",
      "@@@STEP_LOG_END@json.output@@@"
    ]
  },
  {
    "cmd": [
      "vpython",
      "-u",
      "RECIPE_MODULE[recipe_engine::file]/resources/fileutil.py",
      "--json-output",
      "/path/to/tmp/json",
      "copy",
      "{\n  \"another_repo\":\"deadbeef\",\n  \"repo\":\"deadbeef\"\n}",
      "[CLEANUP]/commits.json"
    ],
    "cwd": "[CLEANUP]",
    "infra_step": true,
    "name": "update commits",
    "~followup_annotations": [
      "@@@STEP_LOG_LINE@commits.json@{@@@",
      "@@@STEP_LOG_LINE@commits.json@  \"another_repo\":\"deadbeef\",@@@",
      "@@@STEP_LOG_LINE@commits.json@  \"repo\":\"deadbeef\"@@@",
      "@@@STEP_LOG_LINE@commits.json@}@@@",
      "@@@STEP_LOG_END@commits.json@@@"
    ]
  },
  {
    "cmd": [
      "git",
      "add",
      "[CLEANUP]/commits.json"
    ],
    "cwd": "[CLEANUP]",
    "infra_step": true,
    "name": "git add"
  },
  {
    "cmd": [
      "git",
      "commit",
      "--author=Test Author <testauthor@fake.chromium.org>",
      "--date=Mon Jan 01 00:00:00 2015",
      "-m",
      "Subject\n\nMessage\n\nhttps://dart.googlesource.com/repo/+/deadbeef\n"
    ],
    "cwd": "[CLEANUP]",
    "infra_step": true,
    "name": "git commit"
  },
  {
    "cmd": [
      "git",
      "push",
      "https://dart.googlesource.com/a/linearized_history.git",
      "HEAD:refs/heads/master"
    ],
    "cwd": "[CLEANUP]",
    "infra_step": true,
    "name": "git push"
  },
  {
    "name": "$result"
  }
]