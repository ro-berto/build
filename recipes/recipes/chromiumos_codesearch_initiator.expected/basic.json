[
  {
    "cmd": [
      "vpython",
      "-u",
      "RECIPE_MODULE[recipe_engine::file]/resources/fileutil.py",
      "--json-output",
      "/path/to/tmp/json",
      "glob",
      "[CACHE]/builder",
      "src"
    ],
    "infra_step": true,
    "name": "Check for existing checkout",
    "~followup_annotations": [
      "@@@STEP_LOG_END@glob@@@"
    ]
  },
  {
    "cmd": [
      "git",
      "clone",
      "--progress",
      "https://chromium.googlesource.com/chromiumos/codesearch",
      "src"
    ],
    "cwd": "[CACHE]/builder",
    "env": {
      "GIT_HTTP_LOW_SPEED_LIMIT": "0",
      "GIT_HTTP_LOW_SPEED_TIME": "0"
    },
    "infra_step": true,
    "name": "git clone"
  },
  {
    "cmd": [
      "vpython",
      "-u",
      "RECIPE_MODULE[recipe_engine::file]/resources/fileutil.py",
      "--json-output",
      "/path/to/tmp/json",
      "glob",
      "[CACHE]/builder",
      "chromiumos_codesearch"
    ],
    "infra_step": true,
    "name": "Check for existing checkout (2)",
    "~followup_annotations": [
      "@@@STEP_LOG_END@glob@@@"
    ]
  },
  {
    "cmd": [
      "git",
      "clone",
      "--depth=1",
      "https://chromium.googlesource.com/chromiumos/codesearch",
      "chromiumos_codesearch"
    ],
    "cwd": "[CACHE]/builder",
    "infra_step": true,
    "name": "clone mirror repo"
  },
  {
    "cmd": [
      "git",
      "fetch"
    ],
    "cwd": "[CACHE]/builder/chromiumos_codesearch",
    "infra_step": true,
    "name": "git fetch"
  },
  {
    "cmd": [
      "git",
      "rev-parse",
      "HEAD"
    ],
    "cwd": "[CACHE]/builder/chromiumos_codesearch",
    "infra_step": true,
    "name": "fetch mirror hash"
  },
  {
    "cmd": [
      "git",
      "log",
      "-1",
      "--format=%ct",
      "HEAD"
    ],
    "cwd": "[CACHE]/builder/chromiumos_codesearch",
    "infra_step": true,
    "name": "fetch mirror timestamp"
  },
  {
    "cmd": [
      "prpc",
      "call",
      "-format=json",
      "luci-scheduler.appspot.com",
      "scheduler.Scheduler.EmitTriggers"
    ],
    "infra_step": true,
    "name": "luci-scheduler.EmitTriggers",
    "stdin": "{\"batches\": [{\"jobs\": [{\"job\": \"codesearch-gen-chromiumos-amd64-generic\", \"project\": \"infra\"}], \"trigger\": {\"buildbucket\": {\"properties\": {\"codesearch_mirror_revision\": \"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\", \"codesearch_mirror_revision_timestamp\": \"100\"}, \"tags\": [\"user_agent:recipe\"]}, \"id\": \"6a0a73b0-070b-492b-9135-9f26a2a00001\", \"title\": \"/0\"}}], \"timestamp\": 1337000001500000}",
    "~followup_annotations": [
      "@@@STEP_LOG_LINE@input@{@@@",
      "@@@STEP_LOG_LINE@input@    \"batches\": [@@@",
      "@@@STEP_LOG_LINE@input@        {@@@",
      "@@@STEP_LOG_LINE@input@            \"jobs\": [@@@",
      "@@@STEP_LOG_LINE@input@                {@@@",
      "@@@STEP_LOG_LINE@input@                    \"job\": \"codesearch-gen-chromiumos-amd64-generic\", @@@",
      "@@@STEP_LOG_LINE@input@                    \"project\": \"infra\"@@@",
      "@@@STEP_LOG_LINE@input@                }@@@",
      "@@@STEP_LOG_LINE@input@            ], @@@",
      "@@@STEP_LOG_LINE@input@            \"trigger\": {@@@",
      "@@@STEP_LOG_LINE@input@                \"buildbucket\": {@@@",
      "@@@STEP_LOG_LINE@input@                    \"properties\": {@@@",
      "@@@STEP_LOG_LINE@input@                        \"codesearch_mirror_revision\": \"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\", @@@",
      "@@@STEP_LOG_LINE@input@                        \"codesearch_mirror_revision_timestamp\": \"100\"@@@",
      "@@@STEP_LOG_LINE@input@                    }, @@@",
      "@@@STEP_LOG_LINE@input@                    \"tags\": [@@@",
      "@@@STEP_LOG_LINE@input@                        \"user_agent:recipe\"@@@",
      "@@@STEP_LOG_LINE@input@                    ]@@@",
      "@@@STEP_LOG_LINE@input@                }, @@@",
      "@@@STEP_LOG_LINE@input@                \"id\": \"6a0a73b0-070b-492b-9135-9f26a2a00001\", @@@",
      "@@@STEP_LOG_LINE@input@                \"title\": \"/0\"@@@",
      "@@@STEP_LOG_LINE@input@            }@@@",
      "@@@STEP_LOG_LINE@input@        }@@@",
      "@@@STEP_LOG_LINE@input@    ], @@@",
      "@@@STEP_LOG_LINE@input@    \"timestamp\": 1337000001500000@@@",
      "@@@STEP_LOG_LINE@input@}@@@",
      "@@@STEP_LOG_END@input@@@"
    ]
  },
  {
    "name": "$result"
  }
]